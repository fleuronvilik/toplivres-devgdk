<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <!-- put this at the TOP of <head> on every shell -->
    <style id="preload-guard">html{opacity:0}</style>
    <script>
    (function(){
      try{
        var t = localStorage.getItem('token');
        var role = t ? JSON.parse(atob(t.split('.')[1])).role : null;
        var p = location.pathname;
        if (role==='admin' && p === '/') { location.replace('/admin'); return; }
        if (role==='customer' && (p === '/admin' || p.startsWith('/users/'))) { location.replace('/'); return; }
      }catch(e){}
      var s=document.getElementById('preload-guard'); if(s) s.remove();
    })();
    </script>

    <title>{% block title %}{% endblock %}</title>
    <script type="module" src="{{ url_for('static', filename='js/app.js') }}" defer></script>
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>

  <body>
    <a class="skip-link" href="#main">Skip to main content</a>
    <!--
    <header class="site-header" role="banner" class="hidden">
      <div class="brand">
        <a href="/" class="brand-link" aria-label="TopLivres home">
           Simple text logo; replace with an image if desired
          <span aria-hidden="true">ðŸ“š</span>
          
          <span class="brand-name">TopLivres</span>
        </a>
      </div>
      
      <h1 class="site-title">{% block page_h1 %}TopLivres{% endblock %}</h1>
      <nav class="top-nav" aria-label="Primary">
        <ul>
          <li><a href="/">Home</a></li>
          <li><button id="logoutLink" class="logout-link" type="button">Logout</button></li>
        </ul>
      </nav>
      <button id="logoutLink" class="logout-link" type="button">Logout</button>
    </header> -->

    <main id="main" class="container" tabindex="-1">
        <div id="login-section" class="hidden">
            <form id="loginForm" class="card">
                <label>Email: <input type="email" name="email" required></label>
                <label>Password: <input type="password" name="password" required></label>
                <button type="submit" class="btn btn-submit">Login</button>
            </form>
        </div>
        {% block content %}{% endblock %}
    </main>
    <!--
    <div id="content"></div>
    <div id="footer">
      {% block footer %}
      &copy; Copyright 2010 by <a href="http://domain.invalid/">you</a>.
      {% endblock %}
    </div>
    -->
    <script>
      // Lightweight client-side logout: clear session and return to login
      (function(){
        const link = document.getElementById('logoutLink');
        if (link) {
          link.addEventListener('click', function(){
            try {
              localStorage.removeItem('token');
              localStorage.removeItem('currentUser');
            } catch (e) {}
            // Redirect to home; router/login will take over
            location.assign('/');
          });
        }
      })();
    </script>
  </body>
</html>
